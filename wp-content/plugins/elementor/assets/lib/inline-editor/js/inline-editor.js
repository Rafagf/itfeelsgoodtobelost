!function(e,t){var n,i,r,o={},a=Array.prototype.slice,c={block:/^(?:p|h[1-6]|blockquote|pre)$/,inline:/^(?:justify(center|full|left|right)|strikethrough|insert(un)?orderedlist|(in|out)dent)$/,biu:/^(bold|italic|underline)$/,source:/^(?:createlink|unlink)$/,insert:/^(?:inserthorizontalrule|insertimage|insert)$/,wrap:/^(?:code)$/},s=/^(?:blockquote|pre|div)$/i,l=/(?:[pubia]|strong|em|h[1-6]|blockquote|code|[uo]l|li)/i,u={whiteSpace:/(^\s+)|(\s+$)/g,mailTo:/^(?!mailto:|.+\/|.+#|.+\?)(.*@.*\..+)$/,http:/^(?!\w+?:\/\/|mailto:|\/|\.\/|\?|#)(.*)$/},f={url:/((https?|ftp):\/\/|www\.)[^\s<]{3,}/gi,prefix:/^(?:https?|ftp):\/\//i,notLink:/^(?:img|a|input|audio|video|source|code|pre|script|head|title|style)$/i,maxLength:100},d={bold:{styleKey:"font-weight",correctValue:"normal"},italic:{styleKey:"font-style",correctValue:"normal"},underline:{styleKey:"text-decoration",correctValue:"none"}};function h(e,n){var i=" to exec 「"+e+"」 command"+(n?" with value: "+n:"");try{t.execCommand(e,!1,n)}catch(e){return o.log("fail"+i,!0)}o.log("success"+i)}function p(e,t){var n=function(e){return S(e).filter((function(e){return e.nodeName.match(l)}))}(e);return-1!==n.map((function(e){return e.nodeName.toLowerCase()})).indexOf(t)&&(t="p"),h("formatblock",t)}function g(e,t,n,i){var r=e.config.titles[t]||"",o=document.createElement("div");o.classList.add("pen-icon"),o.setAttribute("title",r),"parent"===n?(o.classList.add("pen-group-icon"),o.setAttribute("data-group-toggle",t)):o.setAttribute("data-action",t),"child"===n&&o.setAttribute("data-group",i);var a,c=e.config.toolbarIconsDictionary[t];c&&c.text?o.textContent=c.text:(a=c&&c.className?c.className:e.config.toolbarIconsPrefix+t,o.innerHTML+='<i class="'+a+'"  ></i>');return o.outerHTML}function m(e){return a.call(e._menu.children)}function v(e,t){m(e).forEach((function(e){q(e,e.getAttribute("data-group")!==t)})),_(e,!t),e.refreshMenuPosition()}function y(e){v(e,null),b(e,!0),function(e,t){var n=e._menu.querySelector('[data-action="unlink"]');if(!n)return;q(n,t),e.refreshMenuPosition()}(e,!e._urlInput||""===e._urlInput.value)}function b(e,t){var n=e._menu.querySelector(".pen-input-wrapper");n&&q(n,t)}function _(e,t){q(e._menu.querySelector('[data-action="close"]'),t),e.refreshMenuPosition()}function C(e,t,n){e.execCommand(t,n),e._range=e.getRange(),e.highlight().menu()}function k(e,t){for(var n,i=e._toolbar||e._menu;!(n=t.getAttribute("data-action"))&&t.parentNode!==i;)t=t.parentNode;var r=t.getAttribute("data-group-toggle");if(r&&v(e,r),n)if("close"!==n){if(!/(?:createlink)|(?:insertimage)/.test(n))return C(e,n);if(e._urlInput){var o=e._urlInput;if(i===e._menu?function(e){m(e).forEach((function(e){q(e,!0)})),b(e),_(e)}(e):(e._inputActive=!0,e.menu()),"none"!==e._menu.style.display){setTimeout((function(){o.focus()}),10);var a=function(){var t=o.value;t?(e.config.linksInNewWindow=e._externalUrlCheckbox.checked,t=o.value.replace(u.whiteSpace,"").replace(u.mailTo,"mailto:$1").replace(u.http,"http://$1")):n="unlink",C(e,n,t)};o.onkeypress=function(e){13===e.which&&(e.preventDefault(),a())},e._externalUrlCheckbox.onchange=a}}}else y(e)}function x(e){var n="",i=function(e){var n=t.createElement("div"),i=t.createElement("input"),r=t.createElement("label"),o=t.createElement("input"),a=t.createElement("i");return n.className="pen-input-wrapper",i.className="pen-url-input",i.type="url",i.placeholder="http://",r.className="pen-icon pen-input-label",o.className="pen-external-url-checkbox",o.type="checkbox",a.className=e.config.toolbarIconsDictionary.externalLink.className,r.appendChild(o),r.appendChild(a),n.appendChild(i),n.appendChild(r),n}(e).outerHTML;if(e._toolbar=e.config.toolbar,e._toolbar)(e._toolbar.querySelectorAll("[data-action=createlink]").length||e._toolbar.querySelectorAll("[data-action=insertimage]").length)&&(n+=i);else{var r=e.config.list;if(!Object.values(r).length)return;o.forEach(r,(function(t,i){if(Array.isArray(t)){var r=t;n+=g(e,t=i,"parent"),o.forEach(r,(function(i){n+=g(e,i,"child",t)}),!0)}else n+=g(e,t)}));var a=Object.values(r);(a.indexOf("createlink")>=0||a.indexOf("insertimage")>=0)&&(n+=i),n+=g(e,"close")}n&&(e._menu=t.createElement("div"),e._menu.setAttribute("class",e.config.class+"-menu pen-menu"),e._menu.innerHTML=n,e._urlInput=e._menu.querySelector(".pen-url-input"),e._externalUrlCheckbox=e._menu.querySelector(".pen-external-url-checkbox"),q(e._menu,!0),t.body.appendChild(e._menu))}function E(n){var i=n._toolbar||n._menu,r=n.config.editor,a=o.delayExec((function(){i&&n.highlight().menu()})),c=function(){};function l(e){n._range=n.getRange(),a(e)}if(n._menu){var u=function(){"flex"===n._menu.style.display&&n.menu()};N(n,e,"resize",u),N(n,e,"scroll",u);var f=!1;N(n,r,"mousedown",(function(){f=!0})),N(n,r,"mouseleave",(function(){f&&l(800),f=!1})),N(n,r,"mouseup",(function(){f&&l(200),f=!1})),c=function(e){!n._menu||A(r,e.target)||A(n._menu,e.target)||(!function(e,t,n,i){var r=e._events[n];if(!r){var o=e._eventTargets.indexOf(t);o>=0&&(r=e._eventsCache[o][n])}if(!r)return e;var a=r.indexOf(i);a>=0&&r.splice(a,1);t.removeEventListener(n,i,!1)}(n,t,"click",c),a(100))}}else N(n,r,"click",(function(){l(0)}));N(n,r,"keyup",(function(e){if(L(n),n.isEmpty())"advanced"===n.config.mode&&R(n);else{if(function(e){var t=e.getRange(),n=t.cloneRange();return n.selectNodeContents(e.config.editor),n.setStart(t.endContainer,t.endOffset),""===n.toString()}(n)&&!function(e){var t=e.getRange(),n=t.cloneRange();return n.selectNodeContents(e.config.editor),n.setEnd(t.startContainer,t.startOffset),""===n.toString()}(n)&&"advanced"!==n.config.mode&&(r.innerHTML=r.innerHTML.replace(/\u200b/,""),M(n)),13!==e.which||e.shiftKey)return l(400);var i=T(n,!0);i&&i.nextSibling&&s.test(i.nodeName)&&i.nodeName===i.nextSibling.nodeName&&("BR"!==i.lastChild.nodeName&&i.appendChild(t.createElement("br")),o.forEach(i.nextSibling.childNodes,(function(e){e&&i.appendChild(e)}),!0),i.parentNode.removeChild(i.nextSibling),$(n,i.lastChild,n.getRange()))}})),N(n,r,"keydown",(function(e){if(r.classList.remove(n.config.placeholderClass),13===e.which&&!e.shiftKey)if(n.config.ignoreLineBreak)e.preventDefault();else{var i=T(n,!0);if(i&&s.test(i.nodeName)){if(i){var o=i.lastChild;if(o&&o.previousSibling&&!o.previousSibling.textContent&&!o.textContent){e.preventDefault();var a=t.createElement("p");a.innerHTML="<br>",i.removeChild(o),i.nextSibling?i.parentNode.insertBefore(a,i.nextSibling):i.parentNode.appendChild(a),$(n,a,n.getRange())}}}else"basic"===n.config.mode&&(e.preventDefault(),h("insertHTML","<br>"))}})),i&&N(n,i,"click",(function(e){k(n,e.target)})),N(n,r,"focus",(function(){n.isEmpty()&&"advanced"===n.config.mode&&R(n),N(n,t,"click",c)})),N(n,r,"blur",(function(){L(n),n.checkContentChange()})),N(n,r,"paste",(function(){setTimeout((function(){n.cleanContent()}))}))}function N(e,t,n,i){if(e._events.hasOwnProperty(n))e._events[n].push(i);else{e._eventTargets=e._eventTargets||[],e._eventsCache=e._eventsCache||[];var r=e._eventTargets.indexOf(t);r<0&&(r=e._eventTargets.push(t)-1),e._eventsCache[r]=e._eventsCache[r]||{},e._eventsCache[r][n]=e._eventsCache[r][n]||[],e._eventsCache[r][n].push(i),t.addEventListener(n,i,!1)}return e}function L(e){e.config.editor.classList[e.isEmpty()?"add":"remove"](e.config.placeholderClass)}function w(e){return(e||"").trim().replace(/\u200b/g,"")}function A(e,t){if(e===t)return!0;for(t=t.parentNode;t;){if(t===e)return!0;t=t.parentNode}return!1}function T(e,t){var n,i=e.config.editor;if(e._range=e._range||e.getRange(),(n=e._range.commonAncestorContainer).hasChildNodes()&&e._range.startOffset+1===e._range.endOffset&&(n=n.childNodes[e._range.startOffset]),!n||n===i)return null;for(;n&&1!==n.nodeType&&n.parentNode!==i;)n=n.parentNode;for(;n&&t&&n.parentNode!==i;)n=n.parentNode;return A(i,n)?n:null}function S(e){for(var t=[],n=T(e);n&&n!==e.config.editor;)n.nodeType===Node.ELEMENT_NODE&&t.push(n),n=n.parentNode;return t}function R(e){var n=e._range=e.getRange();e.config.editor.innerHTML="";var i=t.createElement("p");i.innerHTML="<br>",n.insertNode(i),$(e,i.childNodes[0],n)}function M(e){var n=e.getRange(),i=t.createTextNode("​");n.selectNodeContents(e.config.editor),n.collapse(!1),n.insertNode(i),$(e,i,n)}function $(e,t,n){n.setStartAfter(t),n.setEndBefore(t),n.collapse(!1),e.setRange(n)}function O(e){if(1===e.nodeType){if(f.notLink.test(e.tagName))return;o.forEach(e.childNodes,(function(e){O(e)}),!0)}else if(3===e.nodeType){var n=(a=e.nodeValue||"",c=0,a=a.replace(f.url,(function(e){var t=e,n=e;return c++,e.length>f.maxLength&&(n=e.slice(0,f.maxLength)+"..."),f.prefix.test(t)||(t="http://"+t),'<a href="'+t+'">'+n+"</a>"})),{links:c,text:a});if(!n.links)return;var i=t.createDocumentFragment(),r=t.createElement("div");for(r.innerHTML=n.text;r.childNodes.length;)i.appendChild(r.childNodes[0]);e.parentNode.replaceChild(i,e)}var a,c}function q(e,t){e.style.display=t?"none":"flex"}o.is=function(e,t){return Object.prototype.toString.call(e).slice(8,-1)===t},o.forEach=function(e,t,n){if(e)if(null==n&&(n=o.is(e,"Array")),n)for(var i=0,r=e.length;i<r;i++)t(e[i],i,e);else for(var a in e)e.hasOwnProperty(a)&&t(e[a],a,e)},o.copy=function(e,t){return o.forEach(t,(function(t,n){e[n]=o.is(t,"Object")?o.copy({},t):o.is(t,"Array")?o.copy([],t):t})),e},o.log=function(e,t){(i||t)&&console.log("%cPEN DEBUGGER: %c"+e,"font-family:arial,sans-serif;color:#1abf89;line-height:2em;","font-family:cursor,monospace;color:#333;")},o.delayExec=function(e){var t=null;return function(n){clearTimeout(t),t=setTimeout((function(){e()}),n||1)}},o.merge=function(e){var n={class:"pen",placeholderClass:"pen-placeholder",placeholderAttr:"data-pen-placeholder",debug:!1,toolbar:null,mode:"basic",ignoreLineBreak:!1,toolbarIconsPrefix:"fa fa-",toolbarIconsDictionary:{externalLink:"eicon-editor-external-link"},stay:e.stay||!e.debug,stayMsg:"Are you going to leave here?",textarea:'<textarea name="content"></textarea>',list:["blockquote","h2","h3","p","code","insertOrderedList","insertUnorderedList","inserthorizontalrule","indent","outdent","bold","italic","underline","createlink","insertimage"],titles:{},cleanAttrs:["id","class","style","name"],cleanTags:["script"],linksInNewWindow:!1};return 1===e.nodeType?n.editor=e:e.match&&e.match(/^#[\S]+$/)?n.editor=t.getElementById(e.slice(1)):n=o.copy(n,e),n},(n=function(e){if(!e)throw new Error("Can't find config");i=e.debug;var t=o.merge(e),n=t.editor;if(!n||1!==n.nodeType)throw new Error("Can't find editor");n.classList.add.apply(n.classList,t.class.split(" ")),n.setAttribute("contenteditable","true"),this.config=t,t.placeholder&&n.setAttribute(this.config.placeholderAttr,t.placeholder),L(this),this.selection=r,this._events={change:[]},x(this),E(this),this._prevContent=this.getContent(),this.markdown&&this.markdown.init(this),this.config.stay&&this.stay(this.config),this.config.input&&this.addOnSubmitListener(this.config.input),"advanced"===this.config.mode?(this.getRange().selectNodeContents(n),this.setRange()):M(this)}).prototype.on=function(e,t){return N(this,this.config.editor,e,t),this},n.prototype.addOnSubmitListener=function(e){var t=e.form,n=this;t.addEventListener("submit",(function(){e.value=n.config.saveAsMarkdown?n.toMd(n.config.editor.innerHTML):n.config.editor.innerHTML}))},n.prototype.isEmpty=function(e){return!((e=e||this.config.editor).querySelector("img")||e.querySelector("blockquote")||e.querySelector("li")||w(e.textContent))},n.prototype.getContent=function(){return this.isEmpty()?"":w(this.config.editor.innerHTML)},n.prototype.setContent=function(e){return this.config.editor.innerHTML=e,this.cleanContent(),this},n.prototype.checkContentChange=function(){var e=this._prevContent,t=this.getContent();e!==t&&(this._prevContent=t,function(e,t){if(e._events.hasOwnProperty(t)){var n=a.call(arguments,2);o.forEach(e._events[t],(function(t){t.apply(e,n)}))}}(this,"change",t,e))},n.prototype.getRange=function(){var e=this.config.editor,n=r.rangeCount&&r.getRangeAt(0);return n||(n=t.createRange()),A(e,n.commonAncestorContainer)||(n.selectNodeContents(e),n.collapse(!1)),n},n.prototype.setRange=function(e){(e=e||this._range)||(e=this.getRange()).collapse(!1);try{r.removeAllRanges(),r.addRange(e)}catch(e){}return this},n.prototype.focus=function(e){return e||this.setRange(),this.config.editor.focus(),this},n.prototype.execCommand=function(e,t){if(e=e.toLowerCase(),this.setRange(),c.block.test(e))p(this,e);else if(c.inline.test(e))h(e,t);else if(c.biu.test(e)){var n=d[e];n.backupValue=this.config.editor.style[n.styleKey],this.config.editor.style[n.styleKey]=n.correctValue,h(e,t),this.config.editor.style[n.styleKey]=n.backupValue}else c.source.test(e)?function(e,t,n){e.config.linksInNewWindow&&"unlink"!==t?h("insertHTML",n='<a href="'+n+'" target="_blank">'+r.toString()+"</a>"):h(t,n)}(this,e,t):c.insert.test(e)?function(e,t,n){var i=T(e);if(i)e._range.selectNode(i),e._range.collapse(!1),"insertimage"===t&&e._menu&&q(e._menu,!0),h(t,n)}(this,e,t):c.wrap.test(e)?function(e,t,n){h("insertHTML",n="<"+t+">"+(n||r.toString())+"</"+t+">")}(0,e,t):o.log("can not find command function for name: "+e+(t?", value: "+t:""),!0);"indent"===e&&this.checkContentChange()},n.prototype.cleanContent=function(e){var t=this.config.editor;return e||(e=this.config),o.forEach(e.cleanAttrs,(function(e){o.forEach(t.querySelectorAll("["+e+"]"),(function(t){t.removeAttribute(e)}),!0)}),!0),o.forEach(e.cleanTags,(function(e){o.forEach(t.querySelectorAll(e),(function(e){e.parentNode.removeChild(e)}),!0)}),!0),L(this),this.checkContentChange(),this},n.prototype.autoLink=function(){return O(this.config.editor),this.getContent()},n.prototype.highlight=function(){var e=this._toolbar||this._menu,t=T(this);if(o.forEach(e.querySelectorAll(".active"),(function(e){e.classList.remove("active")}),!0),!t)return this;var n,i=S(this),r=this._urlInput,a=this._externalUrlCheckbox;return r&&e===this._menu&&(r.value="",this._externalUrlCheckbox.checked=!1),n=function(t){if(t){var n=e.querySelector("[data-action="+t+"]");return n&&n.classList.add("active")}},o.forEach(i,(function(e){var t=e.nodeName.toLowerCase(),i=e.style.textAlign,o=e.style.textDecoration;if(i&&("justify"===i&&(i="full"),n("justify"+i[0].toUpperCase()+i.slice(1))),"underline"===o&&n("underline"),t.match(l)){switch(t){case"a":r.value=e.getAttribute("href"),a.checked="_blank"===e.getAttribute("target"),t="createlink";break;case"img":r.value=e.getAttribute("src"),t="insertimage";break;case"i":case"em":t="italic";break;case"u":t="underline";break;case"b":case"strong":t="bold";break;case"strike":t="strikethrough";break;case"ul":t="insertUnorderedList";break;case"ol":t="insertOrderedList";break;case"li":t="indent"}n(t)}}),!0),this},n.prototype.menu=function(){return this._menu?r.isCollapsed?(this._menu.style.display="none",this._inputActive=!1,this):!this._toolbar||this._urlInput&&this._inputActive?void y(this):this:this},n.prototype.refreshMenuPosition=function(){var e=this._range.getBoundingClientRect(),t=e.top-10,n=e.left+e.width/2,i=this._menu,r={x:0,y:0},o=this._stylesheet;if(0===e.width&&0===e.height)return this;if(void 0===this._stylesheet){var a=document.createElement("style");document.head.appendChild(a),this._stylesheet=o=a.sheet}return i.style.display="flex",r.x=n-i.clientWidth/2,r.y=t-i.clientHeight,o.cssRules.length>0&&o.deleteRule(0),r.x<0?(r.x=0,o.insertRule(".pen-menu:after {left: "+n+"px;}",0)):o.insertRule(".pen-menu:after {left: 50%; }",0),r.y<0?(i.classList.add("pen-menu-below"),r.y=e.top+e.height+10):i.classList.remove("pen-menu-below"),i.style.top=r.y+"px",i.style.left=r.x+"px",this},n.prototype.stay=function(e){var t=this;window.onbeforeunload||(window.onbeforeunload=function(){if(!t._isDestroyed)return e.stayMsg})},n.prototype.destroy=function(){var e=this.config;!function(e){o.forEach(this._events,(function(e){e.length=0}),!1),e._eventsCache&&(o.forEach(e._eventsCache,(function(t,n){var i=e._eventTargets[n];o.forEach(t,(function(e,t){o.forEach(e,(function(e){i.removeEventListener(t,e,!1)}),!0)}),!1)}),!0),e._eventTargets=[],e._eventsCache=[])}(this),e.editor.classList.remove.apply(e.editor.classList,e.class.split(" ").concat(e.placeholderClass)),e.editor.removeAttribute("contenteditable"),e.editor.removeAttribute(e.placeholderAttr);try{r.removeAllRanges(),this._menu&&this._menu.parentNode.removeChild(this._menu)}catch(e){}return this._isDestroyed=!0,this},n.prototype.rebuild=function(){return x(this),E(this),this},e.ElementorInlineEditor=function(e){if(!e)return o.log("can't find config",!0);var t=o.merge(e),n=t.editor.getAttribute("class");return n=n?n.replace(/\bpen\b/g,"")+" pen-textarea "+t.class:"pen pen-textarea",t.editor.setAttribute("class",n),t.editor.innerHTML=t.textarea,t.editor};var H={a:[/<a\b[^>]*href=["']([^"]+|[^']+)\b[^>]*>(.*?)<\/a>/gi,"[$2]($1)"],img:[/<img\b[^>]*src=["']([^\"+|[^']+)[^>]*>/gi,"![]($1)"],b:[/<b\b[^>]*>(.*?)<\/b>/gi,"**$1**"],i:[/<i\b[^>]*>(.*?)<\/i>/gi,"***$1***"],h:[/<h([1-6])\b[^>]*>(.*?)<\/h\1>/gi,function(e,t,n){return"\n"+"######".slice(0,t)+" "+n+"\n"}],li:[/<(li)\b[^>]*>(.*?)<\/\1>/gi,"* $2\n"],blockquote:[/<(blockquote)\b[^>]*>(.*?)<\/\1>/gi,"\n> $2\n"],pre:[/<pre\b[^>]*>(.*?)<\/pre>/gi,"\n```\n$1\n```\n"],code:[/<code\b[^>]*>(.*?)<\/code>/gi,"\n`\n$1\n`\n"],p:[/<p\b[^>]*>(.*?)<\/p>/gi,"\n$1\n"],hr:[/<hr\b[^>]*>/gi,"\n---\n"]};n.prototype.toMd=function(){var e=this.getContent().replace(/\n+/g,"").replace(/<([uo])l\b[^>]*>(.*?)<\/\1l>/gi,"$2");for(var t in H)H.hasOwnProperty(t)&&(e=e.replace.apply(e,H[t]));return e.replace(/\*{5}/g,"**")},t.getSelection&&(r=t.getSelection(),e.ElementorInlineEditor=n)}(window,document);
