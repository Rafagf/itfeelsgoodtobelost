function serialize(r){var e,n,t,a="",i=0;switch(_getType=function(r){var e,n,t,a,i=typeof r;if("object"===i&&!r)return"null";if("object"===i){if(!r.constructor)return"object";for(n in(e=(t=r.constructor.toString()).match(/(\w+)\(/))&&(t=e[1].toLowerCase()),a=["boolean","number","string","array"])if(t==a[n]){i=a[n];break}}return i},type=_getType(r),type){case"function":e="";break;case"boolean":e="b:"+(r?"1":"0");break;case"number":e=(Math.round(r)==r?"i":"d")+":"+r;break;case"string":e="s:"+function(r){var e=0,n=0,t=r.length,a="";for(n=0;n<t;n++)e+=(a=r.charCodeAt(n))<128?1:a<2048?2:3;return e}(r)+':"'+r+'"';break;case"array":case"object":for(n in e="a",r)if(r.hasOwnProperty(n)){if("function"===_getType(r[n]))continue;t=n.match(/^[0-9]+$/)?parseInt(n,10):n,a+=this.serialize(t)+this.serialize(r[n]),i++}e+=":"+i+":{"+a+"}";break;default:e="N"}return"object"!==type&&"array"!==type&&("string"==type&&-1!=e.indexOf("}")||(e+=";")),e}function unserialize(r){var e=this,n=function(r){var e=r.charCodeAt(0);return e<128?0:e<2048?1:2};return error=function(r,n,t,a){throw new e.window[r](n,t,a)},read_until=function(r,e,n){for(var t=2,a=[],i=r.slice(e,e+1);i!=n;)t+e>r.length&&error("Error","Invalid"),a.push(i),i=r.slice(e+(t-1),e+t),t+=1;return[a.length,a.join("")]},read_chrs=function(r,e,t){var a,i,o;for(o=[],a=0;a<t;a++)i=r.slice(e+(a-1),e+a),o.push(i),t-=n(i);return[o.length,o.join("")]},_unserialize=function(r,e){var n,t,a,i,o,s,u,c,l,f,h,b,d,p,y,_,g,k,w=0,v=function(r){return r};switch(e||(e=0),t=e+2,n=r.slice(e,e+1).toLowerCase()){case"i":v=function(r){return parseInt(r,10)},w=(l=read_until(r,t,";"))[0],c=l[1],t+=w+1;break;case"b":v=function(r){return 0!==parseInt(r,10)},w=(l=read_until(r,t,";"))[0],c=l[1],t+=w+1;break;case"d":v=function(r){return parseFloat(r)},w=(l=read_until(r,t,";"))[0],c=l[1],t+=w+1;break;case"n":c=null;break;case"s":w=(f=read_until(r,t,":"))[0],h=f[1],t+=w+2,w=(l=read_chrs(r,t+1,parseInt(h,10)))[0],c=l[1],t+=w+2,w!=parseInt(h,10)&&w!=c.length&&error("SyntaxError","String length mismatch");break;case"a":for(c={},w=(a=read_until(r,t,":"))[0],i=a[1],t+=w+2,s=parseInt(i,10),o=!0,b=0;b<s;b++)y=(p=_unserialize(r,t))[1],d=p[2],t+=y,g=(_=_unserialize(r,t))[1],k=_[2],t+=g,d!==b&&(o=!1),c[d]=k;if(o){for(u=new Array(s),b=0;b<s;b++)u[b]=c[b];c=u}t+=1;break;default:error("SyntaxError","Unknown / Unhandled data type(s): "+n)}return[n,t-e,v(c)]},_unserialize(r+"",0)[2]}
